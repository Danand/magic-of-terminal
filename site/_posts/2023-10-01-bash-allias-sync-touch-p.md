---
layout: post
title:  "bash-alias-sync: touch-p"
---

<span class="hidden">Про многобуквенный проект для автоматизации мелких задач.</span>

Это первый (и, надеюсь, не последний) пост про [`bash-alias-sync`](https://github.com/Danand/bash-alias-sync).<br />
В следующих постах, я уже не буду подробно рассказывать о том, что это такое, а буду ссылаться на этот пост.

## Мотивация

Бывает, что приходится вводить аж несколько консольных команд подряд для того, чтобы достичь всего одного фильнального результата.<br />
Например:

```bash
# Создаём папку:
mkdir new-folder

# Создаём в ней пустой файл:
touch new-folder/new-file
```

Это неудобно, как минимум, тем, что:

1. Нужно вводить (в данном случае) 2 команды вместо 1.
2. Нужно либо скопипастить путь к папке, либо ввести его вручную (и без ошибок).

## Решение (топорное)

```bash
folder="new-folder"

mkdir "${folder}"
touch "${folder}/new-file"
```

Очевидные недостатки здесь:

1. 3 строчки вместо уже 2.
2. Taking too much care about the variable substitution.
3. Нельзя переиспользовать.

## Решение (получше)

1. Открываем файл `~/.bashrc` (это тот, который выполняется при старте каждой **Bash**-сессии).
2. Добавляем туда:

   ```bash
   # Функция с уникальным названием,
   # чтобы ни с чем не конфликтовала
   # внутри сессии:
   function touch-p() {
     # Используем локальные переменные,
     # чтобы они ни с чем не конфликтовали
     # внутри сессии:
     local path="$1"

     # Получаем путь к директории,
     # в которой будет лежать файл:
     local dir
     dir="$(dirname "${path}")"

     # Создаём директорию, рекурсивно
     # (аогумент `-p` также не даёт команде
     # кинуть ошибку в случае,
     # если такая директория уже существует):
     mkdir -p "${dir}"

     # Создаём нужный файл:
     touch "${path}"

     # На всякий случай, выводим путь
     # к созданному файлу в `stdout`:
     echo "${path}"
   }
   ```

3. Подгружаем написанный выше код для **текущей** сессии (при старте каждой новой — это делать **не** нужно):

   ```bash
   source ~/.bashrc
   ```

4. Используем:
   - просто создаём файл, внутри ещё даже не существующей папки:

     ```bash
     touch-p new-folder/new-file
     ```

   - _или_, тут же, открываем этот файл в каком-нибудь редакторе (это сработает, как раз, потому, что мы вывели путь в `stdout`, и тут — подхватываем его из `stdin` с помощью `cat`):

     ```bash
     touch-p new-folder/new-file | code "$(cat)"
     ```

## Решение (galaxy brain edition)

А что если упороться и сделать никому не нужное оверкилл решение для синхронизации **Bash**-[элиасов](https://en.wikipedia.org/wiki/Alias_(command)) и функций?

Готово:<br/>
[**https://github.com/Danand/bash-alias-sync**](https://github.com/Danand/bash-alias-sync)

### Как это работает

1. Форкаем репу.
2. Клонируем репу.
3. Запускаем скрипт "установки", чтобы написанные там элиасы и функции подсасывались через `~/.bashrc`:

   ```bash
   cd ./bash-alias-sync
   chmod +x ./install.sh
   ./install.sh
   ```

4. Вносим изменения: например, [добавляем](https://github.com/Danand/bash-alias-sync/commit/4d622b6723760715d3127dbef74ba506f2a0a4af) написанную выше функцию.

5. Синхронизируем элиасы/функции:
   1. Пушим с одной тачки:

      ```bash
      alias-push
      ```

   2. Пулим на другой тачке:

      ```bash
      alias-pull
      ```
